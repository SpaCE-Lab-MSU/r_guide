<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Configuration | MSU SpaCE Lab R Guide</title>
  <meta name="description" content="Collection of R programming techniques and guidelines for collaborating with the MSU SpaCE lab" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Configuration | MSU SpaCE Lab R Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Collection of R programming techniques and guidelines for collaborating with the MSU SpaCE lab" />
  <meta name="github-repo" content="space-lab-msu/r_guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Configuration | MSU SpaCE Lab R Guide" />
  
  <meta name="twitter:description" content="Collection of R programming techniques and guidelines for collaborating with the MSU SpaCE lab" />
  

<meta name="author" content="Patrick Bills" />
<meta name="author" content="Phoebe Zarnetske" />


<meta name="date" content="2020-06-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="documentation.html"/>
<link rel="next" href="contributing-to-this-guide.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MSU SpaCElab R Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="documentation.html"><a href="documentation.html"><i class="fa fa-check"></i><b>1</b> Documentation</a></li>
<li class="chapter" data-level="2" data-path="configuration.html"><a href="configuration.html"><i class="fa fa-check"></i><b>2</b> Configuration</a>
<ul>
<li class="chapter" data-level="2.1" data-path="configuration.html"><a href="configuration.html#quick-points-on-configuration"><i class="fa fa-check"></i><b>2.1</b> Quick Points on Configuration</a></li>
<li class="chapter" data-level="2.2" data-path="configuration.html"><a href="configuration.html#using-renviron"><i class="fa fa-check"></i><b>2.2</b> Using Renviron</a></li>
<li class="chapter" data-level="2.3" data-path="configuration.html"><a href="configuration.html#file-paths-standard-configuration"><i class="fa fa-check"></i><b>2.3</b> File Paths STandard Configuration</a></li>
<li class="chapter" data-level="2.4" data-path="configuration.html"><a href="configuration.html#r-packages-for-configuration"><i class="fa fa-check"></i><b>2.4</b> R Packages for Configuration</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="contributing-to-this-guide.html"><a href="contributing-to-this-guide.html"><i class="fa fa-check"></i><b>3</b> Contributing to this guide</a>
<ul>
<li class="chapter" data-level="3.1" data-path="contributing-to-this-guide.html"><a href="contributing-to-this-guide.html#prerequisites"><i class="fa fa-check"></i><b>3.1</b> Prerequisites</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MSU SpaCE Lab R Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="configuration" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Configuration</h1>
<p>Some details about your code depends on who is running it, or where you are running it, or requires personal secrets such as API keys or passwords. If details are hard-coded into your functions or scripts, it will be hard to share your scripts with collaborators but also for reproducibility.</p>
<p>One constant problem is scripts need to read files from somewhere, and everyone’s computer has different paths, or the paths differ when run in a different environment (e.g. on a high performance computer). We often see scripts with the configuration variables at the top of the script, and you have to edit those to your environment, or comment them out. But then those go into the git repository, so collaborators have to change them back. Even for your own scripts, you may want to change a file path depending on if you are running on your laptop or on the HPC for example. It’s hard to track down all the places where you have to change these parameters (although global search/replace helps). But it would be better if there was a single, consistent place to put all configuration values shared by scripts in a project
Solution</p>
<p>R has a built in feature exactly for this purpose - automaticaly reading a file called <code>.Renviron</code> . Using files that start with “.” (so-called dot-files) for configuration is common in Linux (and these files are hidden). Note There are a couple of libraries to make this a bit more slick, but this document describes only features that are part of Base R. We can add description of how to incorporate those below</p>
<p>Good summary of .Renviron : www.dartistics.com/renviron.html</p>
<p>Not a bad summary of Environment variables : <a href="https://en.wikipedia.org/wiki/Environment_variable" class="uri">https://en.wikipedia.org/wiki/Environment_variable</a></p>
<p>More detail on Environment vars in Mac/Linux : <a href="https://dev.to/gajesh/environment-variables-in-linux-and-mac-os-4j30" class="uri">https://dev.to/gajesh/environment-variables-in-linux-and-mac-os-4j30</a></p>
<p>To see how R reads dot-files .Renviron and .Rprofile, read the R help ?Startup or see this copy on the web ( I don’t know how current the copy is) : <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Startup" class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Startup</a></p>
<p>Note that there is also a package called “startup” on CRAN which is an enhancement and not part of base R.</p>
<p>.Renviron is for setting values for script configuration. It uses the Operating System Environment to store these (e.g. not the same as an R environment), e.g. “environment variables” Any program can read or set an environment variable. One commonly used variable is $HOME which is your home directory.</p>
<div id="quick-points-on-configuration" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Quick Points on Configuration</h2>
<p>when R starts it looks for two files</p>
<p>.Renviron &lt;- set of environment variables listed in here. Written as shell script</p>
<p>.Rprofile &lt;- options for how you like to use R. written as R code</p>
<p>If these files are in the local directory, it reads those and stops.</p>
<p>If not it looks for them in your home directory (global settings). It only reads one version (e.g. it doesn’t read local then also read global settings)</p>
</div>
<div id="using-renviron" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Using Renviron</h2>
<p>Example .Renviron file for you or one of your collaborators. Each person makes their own copy of .Renviron. Note you can use existing operating system variables in this file. This example works for Linux/Mac. Note that this is not R code, and no spaces are allowed around the <code>=</code> equals signs</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="configuration.html#cb3-1"></a><span class="co"># .Renviron file for project X</span></span>
<span id="cb3-2"><a href="configuration.html#cb3-2"></a><span class="va">API_KEY=</span>abc123</span>
<span id="cb3-3"><a href="configuration.html#cb3-3"></a><span class="va">OUTPUT_PATH=</span><span class="st">&quot;</span><span class="va">$HOME</span><span class="st">/Documents/NEONOrganism/DataPull&quot;</span>   </span></code></pre></div>
<p>inside your R script or function (this does not need to be edited )</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="configuration.html#cb4-1"></a>output_path &lt;-<span class="st"> </span><span class="kw">Sys.getenv</span>(<span class="st">&#39;OUTPUT_PATH&#39;</span>)</span>
<span id="cb4-2"><a href="configuration.html#cb4-2"></a>api_key &lt;-<span class="st"> </span><span class="kw">Sys.getenv</span>(<span class="st">&#39;API_KEY&#39;</span>)</span></code></pre></div>
<p>Thie code would be placed in your scripts prior to calling functions that needed these values. For example a function that needed the output path</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="configuration.html#cb5-1"></a>saveStuff &lt;-<span class="st"> </span><span class="cf">function</span>(x,y, output_path){</span>
<span id="cb5-2"><a href="configuration.html#cb5-2"></a></span>
<span id="cb5-3"><a href="configuration.html#cb5-3"></a>    <span class="co"># do stuff with x,y</span></span>
<span id="cb5-4"><a href="configuration.html#cb5-4"></a>    <span class="co"># ...etc</span></span>
<span id="cb5-5"><a href="configuration.html#cb5-5"></a>    output_file &lt;-<span class="st"> </span><span class="kw">file.path</span>(output_path,<span class="st">&quot;myoutput.csv&quot;</span>)    </span>
<span id="cb5-6"><a href="configuration.html#cb5-6"></a>    <span class="kw">write.csv</span>(<span class="dt">x =</span> <span class="kw">data.frame</span>(x,y), <span class="dt">file=</span>output_file)</span>
<span id="cb5-7"><a href="configuration.html#cb5-7"></a>    <span class="kw">return</span>(output_file)</span>
<span id="cb5-8"><a href="configuration.html#cb5-8"></a>    <span class="co"># ... etc</span></span>
<span id="cb5-9"><a href="configuration.html#cb5-9"></a>}</span></code></pre></div>
<p>The main script to run then would</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="configuration.html#cb6-1"></a>x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb6-2"><a href="configuration.html#cb6-2"></a>y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb6-3"><a href="configuration.html#cb6-3"></a>output_path &lt;-<span class="kw">Sys.getenv</span>(<span class="st">&#39;OUTPUT_PATH&#39;</span>)</span>
<span id="cb6-4"><a href="configuration.html#cb6-4"></a>saved_file &lt;-<span class="st"> </span><span class="kw">saveStuff</span>(x, y, output_path)</span></code></pre></div>
<p>If your code requires configuration values and you use an .Renviron file, you note this in your project’s README.md file, and should provide an example of values, or perhaps a file like <code>example.Renviron</code></p>
<p>Suggested Workflow to use lab code that needs configuration in Renviron:</p>
<ol style="list-style-type: decimal">
<li>clone the repository</li>
<li>in the README.md look to see which configuration settings are needed
and/or looked for an example file Renviron text file.<br />
</li>
<li>create a new .Renviron file in the top level folder of the repository with the necessary configuration</li>
<li>open a new Rstudio project in that folder (or start R) which would then read the .Renviron settings</li>
<li>run the code</li>
<li>repeat for different environment (e.g. laptop vs HPCC)</li>
</ol>
<p>workflow when using configuration in your code with Renviron:</p>
<ol style="list-style-type: decimal">
<li>put configuration in .Renviron and add Sys.getenv() calls to set those vars in R</li>
<li>add those configuration vars in Renivron_example.txt with comments to describe possible values</li>
<li>add a list of the configuration need in the README.md</li>
<li>add .Renviron to your <a href="https://help.github.com/en/github/using-git/ignoring-files">.gitignore</a> file to keep it out of github</li>
</ol>
<p>An optional but polite thing to do for other users of your code is to check for these values If the variable is not set, <code>Sys.genenv</code> returns Null.</p>
<p>Can you set a reasonable default if it’s not set in Renviron?
If not, send a me
You could test that the value the user supplied (or default) actually work
4) throw exception if they don’t and print message which value needs to be set and where to look for guidance (see README)</p>
<p>A good example of this is the rredlist package from Bioconductor that pulls data from the IUCN Redlist API. This requires an API key, which the package suggested putting into <code>.Renviron</code> and there is a function that checks if the key provided is Null, or if it’s in Renviron. See</p>
<p><a href="https://github.com/ropensci/rredlist/blob/master/R/zzz.R#L36" class="uri">https://github.com/ropensci/rredlist/blob/master/R/zzz.R#L36</a></p>
<p>Note the .Rprofile should be used to customize your R experience, not set configuration for a particular set of scripts. See <a href="https://www.statmethods.net/interface/customizing.html" class="uri">https://www.statmethods.net/interface/customizing.html</a></p>
</div>
<div id="file-paths-standard-configuration" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> File Paths STandard Configuration</h2>
<p><em>TO BE WRITTEN</em></p>
</div>
<div id="r-packages-for-configuration" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> R Packages for Configuration</h2>
<p>These other packages/features work to make configuration easier, or could be part of a configuration strategy. They are not necessary but may make it easier if your project’s configuration is complex.</p>
<p><strong>startup</strong>: <a href="https://cran.r-project.org/web/packages/startup/vignettes/startup-intro.html" class="uri">https://cran.r-project.org/web/packages/startup/vignettes/startup-intro.html</a></p>
<p>Package from Henrik Bengtsson to make it easier to work with .Renviron and Rprofile. Don’t know how well is plays with config</p>
<p><strong>config</strong>: <a href="https://cran.r-project.org/web/packages/config/vignettes/introduction.html" class="uri">https://cran.r-project.org/web/packages/config/vignettes/introduction.html</a></p>
<p>Package from Rstudio to make it easy to have different Environments so you can easily switch out configuration, for example the paths/data connections you’d use for testing would be different for local and from HPCC. This is especially important when working with “production” or shared databases as you want to develop/test code on a local copy before running it on the central database or one used by an active web application</p>
<p><strong>dotenv</strong>: older package that borrows from python. Does not use Renviron but a “dot-env” or “.env” file just like Renviron. I think using Renviron makes more sense but mention this as it comes up when searching. A package like this is required in Python because there is nothing built-in to handle config.</p>
<p><strong>options</strong>: <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/options.html" class="uri">https://stat.ethz.ch/R-manual/R-devel/library/base/html/options.html</a></p>
<p>part of base R and a way to set options globally so you don’t have to send them as parameter to every function. This is complimentary to Renviron: set config values in Renviron, use the options() function to set global options var in R based on those env variables.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="documentation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="contributing-to-this-guide.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
